---
title: |
   ![](covid19.jfif){width=550px style="display: block; margin:0 auto"}  
output:
  html_document:
    df_print: paged
    toc: true
    number_sections : true
    toc_depth: 2
    toc_float: true 
    theme: readable
    highlight: tango
runtime: shiny
---



```{r setup, include=FALSE}
### Load Libraries
knitr::opts_chunk$set(echo = TRUE)
library(DT)
library(shiny)
library(knitr)
library(kableExtra)
library(tidyverse)
library(ggcorrplot)
library(ggpubr)
library(rstatix)
library("readxl")
library(ggpubr)
library(cowplot)
library(grid)
library(remotes)
library(plotly)
library(tidytext)
library(glue) #for pasting strings
library(tm)
library(wordcloud)
library(RColorBrewer)
library(maps)
library(plotly)
library(forcats)
library(caTools)
library(nnet)

```

# **Effect of COVID-19 Induced Lockdown on Mental Wellbeing of Students Attending Online Classes ** {-} 

**By:**

 * Ammar Ateeq
 * Muhammad Hashim Naveed
 * Sidra Aziz
 
```{r dataset, include=FALSE}
options(max.print=1000000)

### Load Datasets

#Datasets
df_data = read_excel('A Short Survey About Online Studies And Its Effects (Responses).xlsx')
```


# **Related Works**

COVID-19 has had negative consequences on the planet for more than a year, ranging from economic downturns to high mortality tolls that have brought several nations and areas to their knees. We are currently witnessing its catastrophic impacts in the shape of second and third waves, which are claiming a large number of human lives every day in places like India.

There have been numerous studies on the effects of COVID-19, its prediction, symptom analysis in various bodies, academic years across institutes, and their preventive measures in the spirit of continuing studies for students in countries such as the United States, the United Kingdom, and European countries that experience a large number of international students every six months.

Yusen Zhai, Xue Du, 2020 research [1] is one of a few publications that has attempted to determine the impact of COVID-19 on the mental health of college students in the United States.

COVID-19 will have ongoing critical repercussions on college students, according to the report, and "it is thus vital for universities to develop awareness of students' mental health needs and concerns, and to empower their students to seek aid and support throughout this biological crisis."

Our objective is to not only assist in the discovery of the consequences and worries that university students in Germany may have experienced, but also to assist in the development of recommendations that can help shape the future after the debate.

# **Motivation & Overview**

**Objective 1:** The primary objective of the study is to find out a relation between COVID-19 Lockdown effect on mental health of students who have been taking online semesters mainly in Summer and Winter semesters of 2020/2021. When we talk about correlation, what we mean is to find out whether there was a pattern for students to struggle with online study schedules. The reason for this correlation is the potential behind what students have gone through during the year of confinement to dorms or shared homespaces and whether good or bad, effect could be found on their mental health in the result.

The aspects that should help us find this correlation should be the factors such as semester of the student, demographics such as whether they were stranded in their home country or staying in the dorm room, the communication process of steps to attending online classes by the institute, their internet connection as well their grade score quality. Furthermore, we would like to accommodate a subset of the GHQ-12 questionnaire where we ask the students questions around their concentration span, capability of making decisions, feeling of unhappiness or depression, sleep deprivation, constant feeling of stress and the financial situation of the students during this period of time etc.

**Objective 2:** The second objective of the study is to perform and visualize a sentiment analysis using text data that is gathered using the survey and help find out sentiments of students throughout their online study period that they express. For example sentiment polarity scores from negative,neutral to positive and feeling
of happiness, or fear or trust etc.

**Objective 3:** Our third objective is to aim at predicting the grades of the students who are confined in similar demographic situations as well as share somewhat similar sentiments. This study in no way will predict any studentâ€™s depression but only trying to understand whether there are adverse effects on students who have gone ahead for a year with little to no social interaction and at the same time had to go through
a strenuous schedule of studies and/or part time jobs.

**Questionnaire:**
[**_A Short Survey About Online Studies And Its Effects_**](https://docs.google.com/forms/d/1iVyj8rxLUdoJLlmdf9S0So3_HSKjNUd31Zn_Pv5r2Pk/edit)



# **Data**

## **Data Cleaning & Manipulation**

Data cleaning wasn't as big an issue for such a dataset. Given the fact that the answers were fixed options and required, there was no NAs. Except in the questions which required reasoning. It made no sense to remove those rows as we would be losing out on a lot of information if we removed all NAs for those type of questions.

Furthermore, all the categorical answers were converted to factor variable. And label encoding for each of those factor variable.

```{r data_manipulation, include=FALSE}

# change column names to a more understandable variable that are recieved from the form
df_data = df_data %>% 
  rename(
    age = `What is your age?`,
    country = `Which country are you from?`,
    study_in_germany = `Do you study in Germany?`,
    country_study = `Which country were you in while taking online classes?`,
    living_setup = `What is your living setup?`,
    motivation = `Were you motivated to take online classes as compared to regular classes?`,
    motivation_reason = `Please give reason for your previous question's answer below:`,
    concentration = `How has been your concentration span during online studies vs. in-person classes/lectures?`,
    concentration_reason = `Please share some thoughts or explanation on the concentration span in online studies.`,
    sleep = `Has your sleep been affected during online classes?`,
    sleep_reason = `Please share some thoughts on how has your sleep been affected during online classes if you marked previous question as 'yes':`,
    education_strain = `From 1 being lowest and 5 the highest, how much are you in constant strain around the time of assignment submissions, projects, exams or classes in online setting?`,
    graduation_effect = `Did the online class setting effect your graduation timeline or plans?`,
    graduation_effect_reason = `If your answer is 'yes' to previous question, would you like to take a few seconds and describe to us how has it impacted your graduation timeline or future plans?`,
    feeling_unhappiniess = `From scale of 1 to 5 where 1 being the lowest and 5 being the highest, how much has the feeling of unhappiness or anxiety been felt by you during your online classes in COVID-19 situation?`,
    feeling_unhappiness_reason = `Would you like to share your thoughts on what has been the cause of anxiety or worry during this time for you?`,
    insititute_assistance = `How was the assistance from your Institute during COVID-19 when it comes to getting comfortable in online-class decorum? 1 being 'least assistive' to 5 being 'most assistive'.`,
    internet = `Has the internet connection affected you during online classes or online exams?`,
    internet_reason = `If you answered 'yes' to previous question, can you please share thoughts on what kind of effects have you experienced due to poor internet connection?`,
    job_lost = `Did you lose your job due to Covid-19 pendemic?`,
    full_courses_taken = `Were you able to take all the courses that you wanted?`,
    full_courses_taken_reason = `If your answer is 'no' to previous question, what were your immediate thoughts when you were unable to take all the courses in due time?`,
    stranded_outside = `Were you stranded outside your country of education?`,
    stranded_outside_cope = `If your answer is 'yes' to previous question, how did you cope with online studies at that time?`,
    financial_problem = `Did you have financial problem due to COVID-19?`,
    financial_problem_affect = `If your answer is 'yes' to the question above, how do you think it affected your studies?`,
    results_better = `Did you get better results in online-exam setting where you could take the exam in premise of your own home?`,
    additional_notes = `Please share any thoughts in addition that you feel were not addressed in above questions.`
  ) 

# delete columns 1 & 2
df_data <- df_data[, -c(1:2)]

# columns to be changed from character to factor
cols.char <- c("living_setup","education_strain",
              "feeling_unhappiniess","insititute_assistance") 

# change character to factors for chosen columns
df_data[cols.char] <- lapply(df_data[cols.char], factor)


# change the rest of the variables in a consistent level 'No->Maybe->Yes'
df_data$motivation <- factor(df_data$motivation, level = c('No', 'Maybe', 'Yes'))
df_data$concentration <- factor(df_data$concentration, level = c('Bad', 'Same', 'Good'))
df_data$sleep <- factor(df_data$sleep, level = c('No', 'Yes'))
df_data$graduation_effect <- factor(df_data$graduation_effect, level = c('No', 'Yes'))
df_data$internet <- factor(df_data$internet, level = c('No', 'Maybe', 'Yes'))
df_data$job_lost <- factor(df_data$job_lost, level = c('No', 'Yes'))
df_data$full_courses_taken <- factor(df_data$full_courses_taken, level = c('No', 'Yes'))
df_data$stranded_outside <- factor(df_data$stranded_outside, level = c('No', 'Yes'))
df_data$financial_problem <- factor(df_data$financial_problem, level = c('No', 'Maybe', 'Yes'))
df_data$results_better <- factor(df_data$results_better, level = c('No', 'Maybe', 'Yes'))

```

```{r encode_variables,warning=FALSE, message=FALSE, echo=FALSE}

df_data$living_setup_temp = factor(df_data$living_setup,
levels = c('In dorm room','WG / Shared apartment','With Family'),
labels = c(1,2,0))

df_data$motivation_temp = factor(df_data$motivation,
levels = c('Yes','Maybe','No'),
labels = c(0,2,1))

df_data$concentration_temp = factor(df_data$concentration,
levels = c('Good','Same','Bad'),
labels = c(0,2,1))

df_data$sleep_temp = factor(df_data$sleep,
levels = c('No','Yes'),
labels = c(0,1))

df_data$education_strain_temp = factor(df_data$education_strain,
levels = c(5,4,3,2,1),
labels = c(4,3,2,1,0))

df_data$graduation_effect_temp = factor(df_data$graduation_effect,
levels = c('No','Yes'),
labels = c(0,1))

df_data$feeling_unhappiniess_temp = factor(df_data$feeling_unhappiniess,
levels = c(5,4,3,2,1),
labels = c(0,1,2,3,4))

df_data$insititute_assistance_temp = factor(df_data$insititute_assistance,
levels = c(1,2,3,4,5),
labels = c(4,3,2,1,0))

df_data$internet_temp = factor(df_data$internet,
levels = c('No','Maybe','Yes'),
labels = c(0,2,1))

df_data$job_lost_temp = factor(df_data$job_lost,
levels = c('No','Yes'),
labels = c(0,1))

df_data$full_courses_taken_temp = factor(df_data$full_courses_taken,
levels = c('Yes','No'),
labels = c(0,1))

df_data$stranded_outside_temp = factor(df_data$stranded_outside,
levels = c('No','Yes'),
labels = c(0,1))

df_data$financial_problem_temp = factor(df_data$financial_problem,
levels = c('Yes','Maybe', 'No'),
labels = c(0,2,1))

df_data$results_better_temp = factor(df_data$results_better,
levels = c('Yes','Maybe', 'No'),
labels = c(0,2,1))


# For inline R code in next section
germany_students = df_data %>% 
  group_by(study_in_germany) %>%
  summarise(total = n()) %>% 
  filter(study_in_germany == "Yes")

```


## **Overview**


This section will give a breif overview of the demographics of the students who filled out the questionnaire. A total of `r nrow(df_data)` students filled out the form. The graphs will illustrate what nationalities the students are of and the age range. The focus will shift towards the explanatory analysis of the data.

A total of 29 questions were asked in the questionnaire. The format of the options for the questions were ordinal or categorical.

The pie chart below shows that `r germany_students$total` out of the `r nrow(df_data)` students are studying in Germany. Exactly half of the students are in the age range of 26 to 30. Almost 40% are 21 to 25 years of age. The rest are either below 20 or above 30.

```{r data_overview,warning=FALSE, message=FALSE, echo=FALSE }

# Count students who study in Germany and outside Germany
study_country_count = df_data %>% 
  group_by(study_in_germany) %>%
  mutate(
   study_in_germany =  factor(study_in_germany,
levels = c('Yes','No'),
labels = c('Studying in Germany','Studying outside Germany'))
  ) %>% 
  count(sort = TRUE)

# Pie Chart
plot_study_country <- plot_ly(study_country_count, labels = ~study_in_germany, values = ~n, type = 'pie')
plot_study_country <- plot_study_country %>% layout(title = 'Pie Chart of Students Studying in Germany',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

plot_study_country


# Count age rangeof students
df_age_count = df_data %>% 
  group_by(age) %>% 
  count(sort = TRUE)

# Donut chart for age range
fig <- df_age_count %>% plot_ly(labels = ~age, values = ~n)
fig <- fig %>% add_pie(hole = 0.6)
fig <- fig %>% layout(title = "Age Range Distribution",  showlegend = T,
                      legend =list(title=list(text='<b> Age Range </b>')),
                      xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
                      yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

fig
```

## **World Map of Students Nationalities**

```{r worldmap,warning=FALSE, message=FALSE, include=FALSE }

# Count students nationalities
df_country_count = df_data %>% 
  group_by(country) %>% 
  count(sort = TRUE)

df_country_count%>%
  rename(
    Country = country,
    Count = n
  ) %>% 
kbl() %>%
  kable_material_dark("hover", full_width = FALSE)

# Create world map with counts
df_country_count$region <- df_country_count$country
df_country_count$count_group <- cut(df_country_count$n, 
                      breaks = c(-Inf, 5, 10, 15,20,25, 30, Inf), 
                      labels = c("Less than 5", "5-10", "10-15", "15-20","20-25","25-30", "More than 30"))

world_map <- map_data(map = "world")

world_plot = ggplot(df_country_count) +
  geom_map(aes(map_id = country, fill = fct_rev(count_group)), map = world_map) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), colour = 'black', fill = NA) +
  expand_limits(x = world_map$long, y = world_map$lat) +
  scale_fill_manual(name = "Counts", values = rev(brewer.pal(5, name = 'Dark2'))) +
  theme_void() +
  coord_fixed()
```

```{r worldmap_plot, echo=FALSE, fig.width= 12}

renderPlot(world_plot)

```

# **Explaratory Analysis**


```{r frequency_plot,warning=FALSE, message=FALSE, echo=FALSE}

# Function for bar plot for one variable
plot_freq <- function(col1,x_title,y_title,plot_title) {
 df_data %>%
  ggplot(aes(x = .data[[col1]])) +
  geom_bar(fill = "steelblue") + 
  labs(
    x = x_title,
    y = y_title,
    title = plot_title
  )+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))
}

plot_freq("motivation","Student Motivated For Online Classes","Number of Students","Motivation For Online Classes" )

plot_freq("sleep","Sleep Disturbed During Online Classes","Number of Students","Sleep Disturbance During Online Classes" )

plot_freq("education_strain","Education Strain During Online Classes","Number of Students","Strain During Online Classes (1: Low, 5: High)" )

plot_freq("graduation_effect","Graduation Delayed","Number of Students","Plot for Number of Students with Studies Delayed" )

plot_freq("feeling_unhappiniess","Feeling of Unhappiness","Number of Students","Feeling of Unhappiness During Online Classes (1: Low, 5: High)" )

plot_freq("insititute_assistance","University Assistance","Number of Students","University Assistance To Students (1: Low, 5: High)" )

plot_freq("internet","Internet Problem","Number of Students","Internet Caused Problem During Online Classes" )

plot_freq("full_courses_taken","Full Courses Taken","Number of Students","Students Able To Take Full Courses As Wanted" )

plot_freq("stranded_outside","Sleep Disturbance During Online Classes","Number of Students","Number of Students Stranded Outside the Country of Study" )

plot_freq("financial_problem","Financial Problem","Number of Students","Financial Strain Amongst Students" )

plot_freq("living_setup","Type of Living","Number of Students","Living Setup of the Students" )

```


## **Correlations Between Variables**

```{r correlation_plots,warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=6}

# Function for bar plot for two variables

plot_freq_correlation <- function(col1,col2) {
 df_data %>%
  group_by(.data[[col1]],.data[[col2]]) %>%
  summarise(total = n()) %>% 
  mutate(percent = total/sum(total)) %>% 
  ggplot(aes(x = .data[[col1]], y = percent))+
  geom_bar(
    aes(fill = .data[[col1]]), stat = "identity", color = "white",
    position = position_dodge(0.9)
    )+
    theme_bw()+
    scale_y_continuous(labels=scales::percent) +
    theme(plot.title = element_text(hjust = 0.5),
          legend.position = "none",
          axis.title.x=element_blank())
}


# New facet label names for result variable
result.labs1 <- c("Result Worse", "Not Sure or Same", "Result Better")
names(result.labs1) <- c("No","Maybe", "Yes")

# New facet label names for living setup variable
living.labs1 <- c("Single Apartment", "Shared Apartment", "With Family")
names(living.labs1) <- c("In dorm room","WG / Shared apartment","With Family")

# New facet label names for stranded outside variable
stranded.labs1 <- c("Wasn't Stranded", "Stranded Outisde the Country")
names(stranded.labs1) <- c("No","Yes")

# New facet label names for graduation & study outside variable
grad.labs1 <- c("Graduation Not Delayed", "Graduation Delayed")
names(grad.labs1) <- c("No","Yes")

# New facet label names for job variable
job.labs1 <- c("Didn't Lose Job", "Job Lost")
names(job.labs1) <- c("No","Yes")

# New facet label names for motivation variable
motv.labs1 <- c("Not Motivated", "No Change", "Motivated")
names(motv.labs1) <- c("No", "Maybe", "Yes")

# New facet label names for internet variable
internet.labs1 <- c("No Internet Problems", "Not Sure or Same", "Internet Problems")
names(internet.labs1) <- c("No","Maybe", "Yes")

# New facet label names for concentration variable
conc.labs1 <- c("Bad Concentration", "Same Concentration", "Good Concentration")
names(conc.labs1) <- c("Bad", "Same", "Good")

# New facet label names for result variable
finance.labs1 <- c("No Financial Problems", "Not Sure or Same", "Financial Problems")
names(finance.labs1) <- c("No","Maybe", "Yes")



# Plot1
plot_freq_correlation("results_better","concentration")+
  labs(
    x = "Results Better",
    y = "Number of Students",
    title = "Relationship Between Concentration & Results"
  )+
  scale_x_discrete(breaks=c("No","Maybe","Yes"),
                     labels=c("Worse Result","Same or Uncertain", "Better Result"))+
  facet_wrap(~concentration,
             labeller = labeller(concentration = conc.labs1)) + 
  fill_palette("jco")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
      legend.position = "none")


# Plot2
plot_freq_correlation("results_better","motivation")+
  labs(
    x = "Results Better",
    y = "Number of Students",
    title = "Relationship Between Motivation & Results"
  )+
  scale_x_discrete(breaks=c("No","Maybe","Yes"),
                     labels=c("Worse Result","Same or Uncertain", "Better Result"))+
  facet_wrap(~motivation,
             labeller = labeller(motivation = motv.labs1)) + 
  fill_palette("jco")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
      legend.position = "none")


# Plot3
plot_freq_correlation("feeling_unhappiniess","living_setup")+
  labs(
    x = "Level of Unhappiness (1:Low, 5:High)",
    y = "Number of Students",
    title = "Relationship Between Unhappiness Level & Living Setup"
  )+
  facet_wrap(~living_setup,
             labeller = labeller(living_setup = living.labs1)) + 
  fill_palette("jco")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
      legend.position = "none")


#Plot4
plot_freq_correlation("feeling_unhappiniess","job_lost")+
  labs(
    x = "Level of Unhappiness (1:Low, 5:High)",
    y = "Number of Students",
    title = "Relationship Between Job Lost & Unhappiness Level"
  )+
  facet_wrap(~job_lost,
             labeller = labeller(job_lost = job.labs1)) + 
  fill_palette("jco")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
      legend.position = "none")


#Plot5
plot_freq_correlation("feeling_unhappiniess","stranded_outside")+
  labs(
    x = "Level of Unhappiness (1:Low, 5:High)",
    y = "Number of Students",
    title = "Relationship Between Standed Outside Country of Study & Unhappiness Level"
  )+
  facet_wrap(~stranded_outside,
             labeller = labeller(stranded_outside = stranded.labs1)) + 
  fill_palette("jco")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
      legend.position = "none")



```



## **Germany Specific**


It seems rather logical to look a little deeper into just the students studying in Germany. Upon analysis it was found that none of the students studying in Germany are actually living with their families.

Out of 45 students who study in Germany, 22 have said their results have gotten worse and 13 say 'maybe'. That is very high percentage of people compared to the people not living in Germany.

None of the students outside Germany lost their jobs during the pandemic, whereas out of 45 people, 14 people lost their jobs.

71.1% of students studying in Germany show high levels of unhappiness or anxiety. Compared to 38.5% of students studying outside.


Almost 69% of students studying in Germany faced a delay in their study schedule compared to only 23% for students studying outside.




```{r germany_specific,warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=6}

# function for plotting facet bar graph with percentage

plot_facet <- function(col1, col2,facet_lbl,x_title,y_title,plot_title) {
 df_data %>% 
  group_by(.data[[col1]], .data[[col2]]) %>%
  summarise(total = n()) %>% 
  mutate(percent = total/sum(total)) %>% 
  ggplot(aes(x = .data[[col1]], y = percent))+
  geom_bar(
    aes(fill = .data[[col1]]), stat = "identity", color = "white",
    position = position_dodge(0.9)
    )+
    theme_bw()+
    scale_y_continuous(labels=scales::percent) +
    scale_x_discrete(breaks=c("No","Yes"),
                     labels=c("Outside Germany", "In Germany"))+
    theme(plot.title = element_text(hjust = 0.5),
          legend.position = "none",
          axis.title.x=element_blank())
}


#Plot1
plot_facet("study_in_germany", "graduation_effect") +
  facet_wrap(~graduation_effect,
             labeller = labeller(graduation_effect = grad.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Graduation Delay"
  )


#Plot2
plot_facet("study_in_germany", "results_better")+
  facet_wrap(~results_better,
             labeller = labeller(results_better = result.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany ",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Result"
  )
   
# In terms of job lost

#Plot3
plot_facet("study_in_germany", "job_lost")+
  facet_wrap(~job_lost,
             labeller = labeller(job_lost = job.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Job Lost",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Losing Job"
  )


# In terms of motivation
#Plot4
plot_facet("study_in_germany", "motivation")+
  facet_wrap(~motivation,
             labeller = labeller(motivation = motv.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany ",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Motivation"
  )


# In terms of internet problems
#Plot5
plot_facet("study_in_germany", "internet")+
  facet_wrap(~internet,
             labeller = labeller(internet = internet.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany ",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Internet Problems"
  )


# In terms of financial problem
#Plot6
plot_facet("study_in_germany", "financial_problem")+
  facet_wrap(~financial_problem,
             labeller = labeller(financial_problem = finance.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany ",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Financial Problems"
  )


# In terms of concentration
#Plot7
plot_facet("study_in_germany", "concentration")+
  facet_wrap(~concentration,
             labeller = labeller(concentration = conc.labs1)) + 
    fill_palette("jco") +
  labs(
    x = "Studying in Germany ",
    y = "Number of Students (In percentage)",
    title = "Relationship Between Students Studying in Germany & Outside in terms of Concentration"
  )

```



# **Data Modeling**

## **Multinomial Logistic Regression**

To estimate a multinomial logistic regression model, we will use the multinom function from the nnet package. Multinomial regression can also be done with functions from other R packages. We chose the multinom function because it does not need reshaping of data (as the mlogit package requires) and because it closely resembles the sample code in Hilbe's Logistic Regression Models.

Multinom is used to run our model. Because the multinom program does not calculate p-values for regression coefficients, we use Wald tests to do so (here z-tests).

```{r logistic_model,warning=FALSE, message=FALSE, echo=FALSE}

# Fit the model

model <- multinom( concentration ~ job_lost + graduation_effect + motivation, data = df_data)

model <- multinom( concentration ~ study_in_germany + graduation_effect + motivation, data = df_data)

# Summarize the model
summary(model)

predict(model, df_data, type = "probs")

# z-test
z <- summary(model)$coefficients/summary(model)$standard.errors
z

# p-value
p <- (1 - pnorm(abs(z), 0, 1)) * 2
p


# confustion matrix and misclassification rate
cm = table(predict(model), df_data$concentration)

cm %>%
  kbl(caption = "Confusion Matrix for Predicted & Actual Classification") %>%
  kable_classic(full_width = F, html_font = "Cambria") %>%
  add_header_above(c(" ", "Actual" = 3))


# Misclassification rate
1-sum(diag(cm)/sum(cm))


# correct prediction per group
n = table(df_data$concentration)
n/sum(n)
cm/colSums(cm)


# logistic model plot
predicted_data = data.frame(probabiliy_of_grade_better = model$fitted.values, concentration = df_data$concentration,
                            study_germany = df_data$study_in_germany)

predicted_data = predicted_data[order(predicted_data$probabiliy_of_grade_better.Bad, decreasing = FALSE),]

predicted_data$rank = 1:nrow(predicted_data)

ggplot(data = predicted_data, aes(x=rank, y=probabiliy_of_grade_better.Bad)) +
  geom_point(aes(color = concentration), alpha=1, shape=4, stroke=2) +
  labs(
    x = "Index",
    y = "Predicted Probability of getting bad results",
    title = "Multinomial Logistic Regression Prediction Graph"
  )+
  theme_bw()+
  scale_y_continuous(labels=scales::percent) +
  theme(plot.title = element_text(hjust = 0.5))

```

## **Chi-Squared Test**

```{r chi_square,warning=FALSE, message=FALSE, echo=FALSE}

TAB = table(df_data$job_lost, df_data$feeling_unhappiniess)

barplot(TAB, beside = T, legend=T)

CHI = chisq.test(TAB, correct = T)


#attributes(CHI)
#CHI$expected

fisher.test(TAB, conf.int = T, conf.level = 0.99)

library("gplots")

balloonplot(t(TAB), main ="df_data", xlab ="", ylab="",
            label = FALSE, show.margins = FALSE)

```

# **Sentiment Analysis**

## **Word Cloud**
```{r wordcloud,warning=FALSE, message=FALSE, echo=FALSE}

word_count_func <- function(column_name) {
  
  corpus = Corpus(VectorSource(df_data[column_name]))
  corpus = tm_map(corpus, content_transformer(tolower))
  corpus = tm_map(corpus, removeNumbers)
  corpus = tm_map(corpus, removeWords, stopwords("english"))
  corpus = tm_map(corpus, removePunctuation)
  corpus = tm_map(corpus, stripWhitespace)
  
  tdm = TermDocumentMatrix(corpus)
  m = as.matrix(tdm)
  v = sort(rowSums(m), decreasing = TRUE)
  d = data.frame(word = names(v),freq = v)
  
  wordcloud(d$word, d$freq, random.order = FALSE,
            rot.per = 0.3, scale = c(4,.5),
            colors = brewer.pal(8,"Dark2"), max.words = 200, min.freq = 2)
  
  findFreqTerms(tdm, lowfreq = 2)
  
  barplot(d[1:10,]$freq, las = 2, names.arg = d[1:10,]$word,
          col ="pink", main ="Most frequent words",
          ylab = "Word frequencies")
  
  findAssocs(tdm, terms = c("online","classes","different"), corlimit = 0.10)			
  # Find associations for words that occur at least 3 times
  #findAssocs(tdm, terms = findFreqTerms(tdm, lowfreq = 3), corlimit = 0.25)
}

fluidRow(
   column(6,
selectInput(
  inputId = 'PlotColumn',
  label = 'Select a variable from the dataset',
  choices = c('motivation_reason','concentration_reason', 'sleep_reason','graduation_effect_reason','feeling_unhappiness_reason','internet_reason','full_courses_taken_reason', 'stranded_outside_cope','financial_problem_affect','additional_notes')
)
)
)
```

```{r wordcloud_plot,warning=FALSE, message=FALSE, echo=FALSE}
renderPlot(word_count_func(input$PlotColumn))
```


```{r sentiment_analysis,warning=FALSE, message=FALSE, echo=FALSE }
#sentiment function for textual data columns with tokenization using Bing
# regular sentiment score using get_sentiment() function and method of your choice
# please note that different methods may have different scales
#sentiment function for textual data columns with tokenization using Bing
getSentiment_Func <- function(column_name) {
  tidy_column <- df_data %>% 
    unnest_tokens(word, column_name)
  head(tidy_column)
  tidy_column %>%
    inner_join(get_sentiments("bing")) %>% # pull out only sentiment words
    count(sentiment) %>% # count the # of positive & negative words
    spread(sentiment, n, fill = 0) %>% # made data wide rather than narrow
    mutate(columnName = column_name,
           sentiment = positive - negative) # # of positive words - # of negative words
}

Motivation_sentiment <- getSentiment_Func("motivation_reason")
Concentration_sentiment <- getSentiment_Func("concentration_reason")
Sleep_sentiment <- getSentiment_Func("sleep_reason")
Graduation_sentiment <- getSentiment_Func("graduation_effect_reason")
Unhappiness_sentiment <- getSentiment_Func("feeling_unhappiness_reason")
Internet_sentiment <- getSentiment_Func("internet_reason")
FullCoursesTaken_sentiment <- getSentiment_Func("full_courses_taken_reason")
Stranded_sentiment <- getSentiment_Func("stranded_outside_cope")
Financialprob_sentiment <- getSentiment_Func("financial_problem_affect")
AdditionalNotes_sentiment <- getSentiment_Func("additional_notes")

df_sentiment = Reduce(function(x, y) merge(x, y, all=TRUE), list(
  Motivation_sentiment, Concentration_sentiment, Sleep_sentiment, Graduation_sentiment,
  Unhappiness_sentiment,FullCoursesTaken_sentiment,Stranded_sentiment,Financialprob_sentiment,
  AdditionalNotes_sentiment))


#Most common positive and negative words and 
#positive vs. negative sentiments word cloud together
getPosNegcount_Func <- function(column_name) {
  tidy_column <- df_data %>%
    unnest_tokens(word, column_name)
  
  bing_word_counts <- tidy_column %>%
    inner_join(get_sentiments("bing")) %>%
    count(word, sentiment, sort = TRUE) %>%
    ungroup()
  
  library("reshape2")
  tidy_column %>% 
    inner_join(get_sentiments("bing"), "word") %>%
    count(word, sentiment, sort = TRUE) %>% 
    acast(word ~ sentiment, value.var = "n", fill = 0) %>% 
    comparison.cloud(colors = c("coral1", "chartreuse4"), max.words = 100)
  
  bing_word_counts
 
#Bar chart for most common positive and negative words 
  bing_word_counts %>%
    group_by(sentiment) %>%
    slice_max(n, n = 10) %>% 
    ungroup() %>%
    mutate(word = reorder(word, n)) %>%
    ggplot(aes(n, word, fill = sentiment)) +
    geom_col(show.legend = FALSE) +
    facet_wrap(~sentiment, scales = "free_y") +
    labs(x = "Contribution to sentiment",
         y = NULL)
}
getPosNegcount_Func("motivation_reason")
getPosNegcount_Func("concentration_reason")
getPosNegcount_Func("sleep_reason")
getPosNegcount_Func("graduation_effect_reason")
getPosNegcount_Func("feeling_unhappiness_reason")
getPosNegcount_Func("internet_reason")
getPosNegcount_Func("full_courses_taken_reason")
getPosNegcount_Func("stranded_outside_cope")
getPosNegcount_Func("financial_problem_affect")
getPosNegcount_Func("additional_notes")


#bar plot df_sentiment
ggplot(data = df_sentiment %>% gather(Variable, sentiment, -columnName), 
       aes(x = columnName, y = sentiment, fill = Variable)) + 
  geom_bar(stat = 'identity', position = 'dodge')


```


